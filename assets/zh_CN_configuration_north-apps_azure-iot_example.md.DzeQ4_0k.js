import{_ as r,c as a,o as t,ah as o,hY as i,hZ as s,h_ as d,h$ as u,i0 as n,i1 as l,i2 as h,i3 as m,i4 as b,i5 as p,i6 as c,i7 as g,i8 as z,i9 as f,ia as T,ib as _,ic as A,id as I,ie as x}from"./chunks/framework.DGOuNAW6.js";const y=JSON.parse('{"title":"使用 GridBeat 将数据桥接到 Azure IoT Hub","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/configuration/north-apps/azure-iot/example.md","filePath":"zh_CN/configuration/north-apps/azure-iot/example.md"}'),H={name:"zh_CN/configuration/north-apps/azure-iot/example.md"};function D(E,e,C,k,B,P){return t(),a("div",null,[...e[0]||(e[0]=[o('<h1 id="使用-gridbeat-将数据桥接到-azure-iot-hub" tabindex="-1">使用 GridBeat 将数据桥接到 Azure IoT Hub <a class="header-anchor" href="#使用-gridbeat-将数据桥接到-azure-iot-hub" aria-label="Permalink to “使用 GridBeat 将数据桥接到 Azure IoT Hub”">​</a></h1><p>本文将介绍如何使用 GridBeat 通过公网桥接数据到 Azure IoT Hub ，从而借助 Azure IoT Hub 轻松构建 IoT 应用程序。</p><h2 id="什么是-azure-iot-hub" tabindex="-1">什么是 Azure IoT Hub <a class="header-anchor" href="#什么是-azure-iot-hub" aria-label="Permalink to “什么是 Azure IoT Hub”">​</a></h2><p>物联网（IoT）使得设备能够连接到互联网并相互通信，改变了我们生活和工作的方式。Azure IoT Hub 是由微软提供的云服务，是一个完全托管的服务，使组织能够管理、监控和控制物联网设备。</p><p>此外，Azure IoT Hub 实现了可靠、安全的双向通信，连接了物联网设备和基于云的服务。它允许开发人员从物联网设备接收消息，并向其发送消息，作为通信的中心消息枢纽。它还可以帮助组织利用从物联网设备获取的数据，将物联网数据转化为可操作的洞察力。</p><h2 id="azure-iot-hub-配置" tabindex="-1">Azure IoT Hub 配置 <a class="header-anchor" href="#azure-iot-hub-配置" aria-label="Permalink to “Azure IoT Hub 配置”">​</a></h2><p>以下是使用 Azure IoT Hub 的简略步骤。</p><h3 id="创建-azure-iot-hub" tabindex="-1">创建 Azure IoT Hub <a class="header-anchor" href="#创建-azure-iot-hub" aria-label="Permalink to “创建 Azure IoT Hub”">​</a></h3><p>初始设置过程非常简单。您将需要一个有效的 Azure 订阅。如果您没有，请创建一个免费账户。</p><p>订阅后，登录 <a href="https://portal.azure.com/" target="_blank" rel="noreferrer">Azure portal</a>。导航到 IoT Hub 标签页，然后点击<strong>创建</strong>按钮。您需要提供订阅、资源组、区域和 IoT Hub 的名称等详细信息。填写完这些信息后，点击<strong>查看 + 创建</strong>按钮来创建您的 IoT Hub。</p><p>这里我们创建一个名为 <em>emqx-hub</em> 的 IoT Hub，其域名为 <em>emqx-hub.azure-devices.net</em> 。</p><figure align="center"><img src="'+i+'" style="border:thin solid #E0DCD9;width:60%;" alt="set up Azure IoT Hub"></figure><h3 id="注册设备到-azure-iot-hub" tabindex="-1">注册设备到 Azure IoT Hub <a class="header-anchor" href="#注册设备到-azure-iot-hub" aria-label="Permalink to “注册设备到 Azure IoT Hub”">​</a></h3><p>在创建好 Azure IoT Hub 后，下一步是将设备注册到 Hub 中。</p><p>要注册设备，请在 IoT Hub 的 IoT 设备标签页，点击<strong>添加</strong>按钮。为设备提供一个唯一的名称，然后点击<strong>保存</strong>。</p><p>在这里，我们为 GridBeat 注册了一个名为 <em>client-005</em> 的设备。</p><figure align="center"><img src="'+s+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Hub add device"></figure><h3 id="使用-azure-iot-explorer" tabindex="-1">使用 Azure IoT Explorer <a class="header-anchor" href="#使用-azure-iot-explorer" aria-label="Permalink to “使用 Azure IoT Explorer”">​</a></h3><p>一旦您的设备连接到 Azure IoT Hub，它们就可以开始向 Hub 发送消息。这些消息可以是遥测数据，比如传感器读数，或者您希望从设备发送到云端的任何其他数据。 相反的，消息也可以从 Hub 发送到设备。</p><p>我们将使用 <a href="https://learn.microsoft.com/en-us/azure/iot/howto-use-iot-explorer" target="_blank" rel="noreferrer">Azure IoT Explorer</a> 来监听 Azure IoT Hub 和 GridBeat之间的消息。</p><p>第一次运行 Azure IoT Explorer 时，会提示您输入 IoT Hub 的连接字符串。 在 <a href="https://portal.azure.com/" target="_blank" rel="noreferrer">Azure portal</a> 中找到<em>emqx-hub</em> IoT Hub的连接字符串。</p><figure align="center"><img src="'+d+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Hub connection string"></figure><p>在 Azure IoT Explorer 中添加连接字符串后，点击<strong>连接</strong>。</p><figure align="center"><img src="'+u+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Explorer connect"></figure><h3 id="设备身份验证" tabindex="-1">设备身份验证 <a class="header-anchor" href="#设备身份验证" aria-label="Permalink to “设备身份验证”">​</a></h3><p>Azure IoT Hub 使用<a href="https://learn.microsoft.com/en-us/azure/iot-hub/authenticate-authorize-sas?tabs=node" target="_blank" rel="noreferrer">共享访问签名</a> (SAS) 令牌对设备和服务进行身份验证，以避免在网络上发送密钥。 可以使用 SAS 令牌向设备和服务授予限时访问 IoT Hub 特定功能的权限。 若要获取授权连接到 IoT Hub，设备和服务必须发送使用共享访问或对称密钥进行签名的 SAS 令牌。</p><p>如果不使用 SAS 令牌，Azure IoT Hub 也可以使用 X.509 证书对设备进行身份验证。为此，您首先需要<a href="https://learn.microsoft.com/en-us/azure/iot-hub/tutorial-x509-test-certs?tabs=linux" target="_blank" rel="noreferrer">创建和上传证书</a>。</p><p>为了方便，Azure IoT Explorer 可以帮助生成 SAS 令牌。</p><figure align="center"><img src="'+n+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Explorer SAS token"></figure><h2 id="配置-gridbeat" tabindex="-1">配置 GridBeat <a class="header-anchor" href="#配置-gridbeat" aria-label="Permalink to “配置 GridBeat”">​</a></h2><h3 id="创建南向设备" tabindex="-1">创建南向设备 <a class="header-anchor" href="#创建南向设备" aria-label="Permalink to “创建南向设备”">​</a></h3><p>本文使用 <a href="./../../south-devices/modbus-tcp/modbus-tcp.html">Modbus TCP 插件</a>创建南向设备，采集数据。</p><h4 id="添加-modbus-tcp-节点" tabindex="-1">添加 <em>modbus-tcp</em> 节点 <a class="header-anchor" href="#添加-modbus-tcp-节点" aria-label="Permalink to “添加 modbus-tcp 节点”">​</a></h4><p>在控制面板，点击<strong>南向设备 -&gt; 添加设备</strong>，选择 Modbus TCP 插件添加节点 <em>modbus-tcp</em> 。配置节点，连接到位于端口 <code>60502</code> 的 Modbus 模拟器。</p><figure align="center"><img src="'+l+'" style="border:thin solid #E0DCD9;width:60%;" alt="Add modbus node in GridBeat dashboard"></figure><h4 id="创建组" tabindex="-1">创建组 <a class="header-anchor" href="#创建组" aria-label="Permalink to “创建组”">​</a></h4><p>点击 <em>modbus-tcp</em> 节点，创建组，设置组名为 <em>group</em>，间隔为 <em>1000</em> 。</p><figure align="center"><img src="'+h+'" style="border:thin solid #E0DCD9;width:60%;" alt="Add a group to the modbus node in GridBeat dashboard"></figure><h4 id="添加点位" tabindex="-1">添加点位 <a class="header-anchor" href="#添加点位" aria-label="Permalink to “添加点位”">​</a></h4><p>添加一个点位，名字为 <em>tag0</em>，类型为 <em>INT16</em> 。</p><figure align="center"><img src="'+m+'" style="border:thin solid #E0DCD9;width:60%;" alt="Add a tag to the modbus node in GridBeat dashboard"></figure><p>配置完成后，<em>modbus-tcp</em> 节点显示处于连接状态。</p><figure align="center"><img src="'+b+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat dashboard sourth devices tab showing modbus node connected"></figure><h3 id="创建北向应用" tabindex="-1">创建北向应用 <a class="header-anchor" href="#创建北向应用" aria-label="Permalink to “创建北向应用”">​</a></h3><h4 id="添加-azure-节点" tabindex="-1">添加 <em>azure</em> 节点 <a class="header-anchor" href="#添加-azure-节点" aria-label="Permalink to “添加 azure 节点”">​</a></h4><p>点击<strong>北向应用 -&gt; 添加应用</strong>，选择 Azure IoT 插件。</p><figure align="center"><img src="'+p+'" style="border:thin solid #E0DCD9;width:60%;" alt="Add azure node in GridBeat dashboard"></figure><p>在<strong>应用配置</strong>标签页，对 <em>azure</em> 节点进行配置。 为了建立与 Azure IoT Hub 的 MQTT 连接，GridBeat Azure IoT 插件需要使用<strong>共享访问签名（Shared Access Signature）</strong> 或 <strong>X.509 证书</strong>进行身份验证。在这里，我们提供了一个 <strong>SAS 令牌</strong>。</p><figure align="center"><img src="'+c+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat dashboard north apps tab"></figure><p>配置完成后，<em>azure</em> 节点将成功连接 Azure IoT Hub 。</p><figure align="center"><img src="'+g+'" style="border:thin solid #E0DCD9;width:60%;" alt="azure node connected state in GridBeat dashboard"></figure><h4 id="订阅-modbus-tcp-节点" tabindex="-1">订阅 <em>modbus-tcp</em> 节点 <a class="header-anchor" href="#订阅-modbus-tcp-节点" aria-label="Permalink to “订阅 modbus-tcp 节点”">​</a></h4><p>点击 <em>azure</em> 节点，然后点击<strong>添加订阅</strong>，选择 <em>modbus-tcp</em> 节点和 <em>group</em> 组。</p><p>GridBeat Azure IoT 连接成功后，使用 MQTT 主题<code>devices/{device-id}/messages/events/</code> 将消息发送到 Azure IoT Hub，其中 <code>{device-id}</code> 是已注册设备的<strong>设备 ID</strong>。 在我们的情况下，<em>azure</em> 节点将向主题 <code>devices/client-005/messages/events/</code> 发布南向设备数据。</p><figure align="center"><img src="'+z+'" style="border:thin solid #E0DCD9;width:60%;" alt="azure node subscribe to modbus node"></figure><figure align="center"><img src="'+f+'" style="border:thin solid #E0DCD9;width:60%;" alt="azure node subscribe list"></figure><h2 id="监控数据" tabindex="-1">监控数据 <a class="header-anchor" href="#监控数据" aria-label="Permalink to “监控数据”">​</a></h2><p>订阅 <em>modbus-tcp</em> 节点的 <em>group</em> 组后，<em>azure</em> 节点会将数据推送到 Azure IoT Hub 。点击<strong>数据监控</strong>，选择 <em>modbus-tcp</em> 节点和 <em>group</em> 组。可以看到 GridBeat 报告了 <em>tag0</em> 的值为 <em>0</em> 。</p><figure align="center"><img src="'+T+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat dashboard data monitoring tab"></figure><p>在 Azure IoT Explorer 中，点击 <strong>Telemetry -&gt; Start</strong> 以查看设备到云端的消息。我们可以验证 Azure IoT Hub 是否正确接收到数据。</p><figure align="center"><img src="'+_+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Explorer telemetry 1"></figure><h2 id="写入数据" tabindex="-1">写入数据 <a class="header-anchor" href="#写入数据" aria-label="Permalink to “写入数据”">​</a></h2><p>在 Azure IoT Explorer 中，点击 <strong>Cloud-to-device message</strong> 向 GridBeat 发送写请求，将值 <em>42</em> 写入点位 <em>tag0</em> 。</p><figure align="center"><img src="'+A+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Explorer write"></figure><p>在<strong>数据监控</strong>标签页，可以看到 GridBeat 将点位 <em>tag0</em> 的值更新为写入的值 <em>42</em> 。</p><figure align="center"><img src="'+I+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat dashboard data monitoring tab"></figure><p>并且 Azure IoT Hub 也收到了更新后的点位值 <em>42</em>。</p><figure align="center"><img src="'+x+'" style="border:thin solid #E0DCD9;width:60%;" alt="Azure IoT Explorer telemetry 2"></figure>',68)])])}const G=r(H,[["render",D]]);export{y as __pageData,G as default};
