import{_ as s,c as t,o as i,ah as l,gM as e,gN as n,gO as d,gP as h}from"./chunks/framework.D2dsaVOY.js";const m=JSON.parse('{"title":"管理日志","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/admin/log-management.md","filePath":"zh_CN/admin/log-management.md"}'),p={name:"zh_CN/admin/log-management.md"};function r(o,a,k,g,c,b){return i(),t("div",null,[...a[0]||(a[0]=[l('<h1 id="管理日志" tabindex="-1">管理日志 <a class="header-anchor" href="#管理日志" aria-label="Permalink to “管理日志”">​</a></h1><p>在 Web 页面一键下载所有日志文件的功能，如下图所示。</p><p><img src="'+e+'" alt="download_log"></p><h2 id="文件夹结构" tabindex="-1">文件夹结构 <a class="header-anchor" href="#文件夹结构" aria-label="Permalink to “文件夹结构”">​</a></h2><p>下载日志的功能将把 /gridbeat/build/logs 的文件夹打包成 gridbeat_logs.tar.gz 文件并下载。文件包含所有已创建的驱动及 GridBeat 的日志文件，文件目录级别示例，如下图所示。</p><img src="'+n+'" alt="gridbeat_logs" style="zoom:50%;"><ul><li>data-stream-processing.log：数据处理配置</li><li>dlt645.log：北向应用配置</li><li>modbus-plus-tcp.log：南向设备配置</li><li>gridbeat.log：GridBeat 日志</li></ul><h2 id="节点-debug-日志" tabindex="-1">节点 DEBUG 日志 <a class="header-anchor" href="#节点-debug-日志" aria-label="Permalink to “节点 DEBUG 日志”">​</a></h2><p>GridBeat 支持设置打印某个节点的 debug 级别日志，并在大致十分钟后自动切回默认的日志等级。每个节点之间的设置相互独立。</p><p>每个节点的 <strong>更多</strong> 操作按键中都有一个 <strong>DEBUG 日志</strong> 的操作按键，如下图所示。</p><p><img src="'+d+'" alt="debug_log"></p><p>点击此按键后，页面将跳出如下图所示的提示。</p><p><img src="'+h+`" alt="debug_log_tip"></p><p>此时，该节点开始打印 debug 日志，用户可选择在十分钟后下载日志，查看对应节点的日志，也可以选择在 /build/logs 下实时查看节点打印的日志。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>打印节点 debug 日志的同时 gridbeat 日志也会打印，并在十分钟后自动切回默认的日志等级。</p></div><h2 id="日志配置文件" tabindex="-1">日志配置文件 <a class="header-anchor" href="#日志配置文件" aria-label="Permalink to “日志配置文件”">​</a></h2><p>GridBeat 日志配置文件 <code>zlog.conf </code>的格式如下所示：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[global]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> perms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 666</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[formats]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">simple</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%d [%V] %f:%L %m%n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[rules]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     &quot;./logs/%c.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, 50MB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./logs/%c.#2s.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">simple</span></span></code></pre></div><p>配置文件分为三个部分：[global]，[formats]，[rules]。</p><h3 id="全局参数-global" tabindex="-1">全局参数 Global <a class="header-anchor" href="#全局参数-global" aria-label="Permalink to “全局参数 Global”">​</a></h3><p>file perms：指定创建文件的缺省访问权限：</p><ul><li>600，只有拥有者有读写权限；</li><li>644，只有拥有者有读写权限；而属组用户和其他用户只有读权限；</li><li>700，只有拥有者有读、写、执行权限；</li><li>755，拥有者有读、写、执行权限；而属组用户和其他用户只有读、执行权限；</li><li>711，拥有者有读、写、执行权限；而属组用户和其他用户只有执行权限；</li><li>666，所有用户都有文件读、写权限；</li><li>777，所有用户都有读、写、执行权限。</li></ul><h3 id="格式-formats" tabindex="-1">格式 Formats <a class="header-anchor" href="#格式-formats" aria-label="Permalink to “格式 Formats”">​</a></h3><p>转换格式串：转换格式串类似 C 的 printf 函数。可以自定义日志的格式，方法如下：format_name 为格式的名字，your format 替换为自定义的格式，格式要位于引号之内。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;your format&quot;</span></span></code></pre></div><ul><li>%d，打印日志时间；</li><li>%V，日志级别，大写；</li><li>%f，源代码文件名；</li><li>%L，源代码行数；</li><li>%m，用户日志，用户从 zlog 函数输入的日志；</li><li>%n，换行符。</li></ul><h3 id="规则-rules" tabindex="-1">规则 Rules <a class="header-anchor" href="#规则-rules" aria-label="Permalink to “规则 Rules”">​</a></h3><p>规则描述了日志是怎么被过滤、格式化以及被输出的。 语法：</p><blockquote><p>(category).(level) (output),(options, optional); (format name, optional)</p></blockquote><h4 id="category" tabindex="-1">category <a class="header-anchor" href="#category" aria-label="Permalink to “category”">​</a></h4><p>分类等级。</p><table tabindex="0"><thead><tr><th>总结</th><th>配置文件规则分类</th><th>匹配的代码分类</th><th>不匹配的代码分类</th></tr></thead><tbody><tr><td>*匹配所有</td><td>*.*</td><td>aa，aa_bb，aa_cc，yy ...</td><td>NONE</td></tr><tr><td>以_结尾的分类匹配本级及下级分类</td><td>aa_.*</td><td>aa, aa_bb, aa_cc, aa_bb_cc</td><td>xx, yy</td></tr><tr><td>不以_结尾的精确匹配分类名</td><td>aa.*</td><td>aa</td><td>aa_bb, aa_cc, aa_bb_cc</td></tr><tr><td>！匹配没有找到规则的分类</td><td>!.*</td><td>xx</td><td>aa</td></tr></tbody></table><h4 id="level" tabindex="-1">level <a class="header-anchor" href="#level" aria-label="Permalink to “level”">​</a></h4><p>zlog 有六个默认的等级：“DEBUG”，“INFO”，“NOTICE”，“WARN”，“ERROR”，“FATAL”。例如，*.DEBUG 任何大于等于 DEBUG 级别的日志都会被输出。</p><table tabindex="0"><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td>*.*</td><td>所有等级</td></tr><tr><td>*.debug</td><td>代码内等级 &gt;= debug</td></tr><tr><td>*.=debug</td><td>代码内等级 == debug</td></tr><tr><td>*.!debug</td><td>代码内等级 != debug</td></tr></tbody></table><h4 id="output-options-optional" tabindex="-1">(output),(options, optional); <a class="header-anchor" href="#output-options-optional" aria-label="Permalink to “(output),(options, optional);”">​</a></h4><p>[输出],[附加选项，可选];</p><table tabindex="0"><thead><tr><th>动作</th><th>输出字段</th><th>附加选项</th></tr></thead><tbody><tr><td>标准输出</td><td>&gt;stdout</td><td>无意义</td></tr><tr><td>标准错误输出</td><td>&gt;stderr</td><td>无意义</td></tr><tr><td>输出到syslog</td><td>&gt;syslog</td><td>syslog设施(facilitiy)：LOG_USER(default)，LOG_LOCAL[0-7] 必填</td></tr><tr><td>管道输出</td><td>|cat</td><td>无意义</td></tr><tr><td>文件</td><td>&quot;文件路径&quot;</td><td>文件转档，10M * 3 ～ &quot;press.#r.log&quot;。例如，&quot;./logs/%c.log&quot;, 50MB * 1 ~ &quot;./logs/%c.#2s.log&quot; 表示每到 50M 转档，#2s 的意思是序号的长度最少为 2 位，从 00 开始编号。</td></tr><tr><td>同步IO文件</td><td>-&quot;文件路径&quot;</td><td></td></tr><tr><td>用户自定义输出</td><td>$name</td><td>&quot;path&quot; 动态或者静态的用于record输出</td></tr></tbody></table><p>例如将日志只输出到 syslog</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[global]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> perms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 666</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[formats]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">simple</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%d [%V] %f:%L %m%n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[rules]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    	&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">syslog, LOG_LOCAL0; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">simple</span></span></code></pre></div><h4 id="format-name-optional" tabindex="-1">(format name, optional) <a class="header-anchor" href="#format-name-optional" aria-label="Permalink to “(format name, optional)”">​</a></h4><p>[格式名，可选]</p><h2 id="开发调试配置文件" tabindex="-1">开发调试配置文件 <a class="header-anchor" href="#开发调试配置文件" aria-label="Permalink to “开发调试配置文件”">​</a></h2><p>GridBeat 还提供了 开发调试配置文件 <code>dev.conf</code>，打印日志同时将日志输出到终端，启动 gridbeat 时添加 <code>--log</code> 参数则调用 <code>dev.conf</code>。</p>`,44)])])}const y=s(p,[["render",r]]);export{m as __pageData,y as default};
