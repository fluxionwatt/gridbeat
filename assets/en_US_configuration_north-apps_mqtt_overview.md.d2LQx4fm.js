import{_ as e,c as i,o as a,ah as n,c8 as s,c9 as o,ca as r}from"./chunks/framework.DGOuNAW6.js";const f=JSON.parse('{"title":"MQTT","description":"","frontmatter":{},"headers":[],"relativePath":"en_US/configuration/north-apps/mqtt/overview.md","filePath":"en_US/configuration/north-apps/mqtt/overview.md"}'),l={name:"en_US/configuration/north-apps/mqtt/overview.md"};function d(h,t,c,p,u,g){return a(),i("div",null,[...t[0]||(t[0]=[n(`<h1 id="mqtt" tabindex="-1">MQTT <a class="header-anchor" href="#mqtt" aria-label="Permalink to “MQTT”">​</a></h1><p><a href="https://mqtt.org" target="_blank" rel="noreferrer">MQTT</a> is a messaging protocol designed for IoT devices and applications operating on a publish/subscribe model. It&#39;s lightweight, efficient, reliable, and allows for real-time communication. MQTT is well-suited for environments with limited resources, where efficient use of power and bandwidth is necessary.</p><p>GridBeat supports MQTT as one of its communication protocols. The GridBeat MQTT plugin allows users to quickly build IoT applications that use MQTT communication between devices and the cloud.</p><p>Using the MQTT plugin, developers can also publish messages back to IoT devices, triggering actions such as turning lights, motors, and other equipment on or off.</p><p>The plugin also supports secure communication with devices, using authentication and encrypted communication protocols to ensure data safety and privacy.</p><h2 id="add-application" tabindex="-1">Add Application <a class="header-anchor" href="#add-application" aria-label="Permalink to “Add Application”">​</a></h2><p>To create a northbound MQTT node and connect it to an MQTT Broker to upload data, navigate to <strong>Configuration -&gt; North Apps</strong> and click <strong>Add Application</strong> to add an MQTT client node.</p><ul><li>Name: The name of this application node, for example, &quot;mqtt&quot;.</li><li>Plugin: Select the MQTT plugin.</li></ul><h2 id="configure-application" tabindex="-1">Configure Application <a class="header-anchor" href="#configure-application" aria-label="Permalink to “Configure Application”">​</a></h2><p>See the table below for the configuration parameters.</p><table tabindex="0"><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><strong>MQTT Version</strong></td><td>The version of MQTT protocol, default v3.1.1.</td></tr><tr><td><strong>Client ID</strong></td><td>MQTT client id for communication, a required field.</td></tr><tr><td><strong>QoS Level</strong></td><td>MQTT QoS level for message delivery, optional, default QoS 0.</td></tr><tr><td><strong>Upload Format</strong></td><td>JSON format of reported data, a required field: <br><br> - <em>values-format</em>, data are split into <code>values</code> and <code>errors</code> sub-objects. <br>- <em>tags-format</em>, tag data are put in a single array. <br>- <em>ECP-format</em>：Add tag types on the basis of <em>tags-format</em>.<br>- <em>Custom</em>：Customize the reported data format. <br><br>For data communication format, see <a href="./api.html#write-tag">Upstream/Downstream Data Format</a></td></tr><tr><td><strong>Upload Tag Error Code</strong></td><td>When data tag collection reports an error, report the tag error code, default enabled.</td></tr><tr><td><strong>Write Request Topic</strong></td><td>MQTT topic to which the plugin subscribes for write requests. For data communication format, see <a href="./api.html#write-tag">Upstream/Downstream Data Format</a> . If tracing is enabled, configure the user properties <code>traceparent</code> and <code>tracestate</code> according to the W3C standard.</td></tr><tr><td><strong>Write Response Topic</strong></td><td>MQTT topic to which the plugin sends write responses.</td></tr><tr><td><strong>Driver Status Report</strong></td><td>Reports status of all the southbound nodes to the specified topic.</td></tr><tr><td><strong>Status Report Topic</strong></td><td>The topic for status reporting.</td></tr><tr><td><strong>Status Report Interval</strong></td><td>The time interval for reporting the status of the southbound node, in seconds. The range is 1-3600, default 1.</td></tr><tr><td><strong>Offline Data Caching</strong></td><td>Offline data caching switch. Cache MQTT messages when offline, and sync cached messages when back online.</td></tr><tr><td><strong>Cache Memory Size</strong></td><td>In-memory cache limit (MB) in case of communication failure, a required field. Range in [0, 1024]. Should not be larger than <em>Cache Disk Size</em>. For details about the cache feature, see <a href="#offline-data-caching">Offline Data Caching</a></td></tr><tr><td><strong>Cache Disk Size</strong></td><td>In-disk cache limit (MB) in case of communication failure, a required field. Range in [0, 10240]. If nonzero, <em>cache-mem-size</em> should also be nonzero.</td></tr><tr><td><strong>Cache Sync Interval</strong></td><td>Time interval (MS) between each message to sync when communication restores. Range in [10, 120000].</td></tr><tr><td><strong>Broker Host</strong></td><td>MQTT Broker host, a required field.</td></tr><tr><td><strong>Broker Port</strong></td><td>MQTT Broker port number, a required field.</td></tr><tr><td><strong>Username</strong></td><td>Username when connecting to the broker, optional.</td></tr><tr><td><strong>Password</strong></td><td>Password when connecting to the broker, optional.</td></tr><tr><td><strong>SSL</strong></td><td>Whether to enable MQTT SSL, default false. For details, see <a href="#mqtt-over-ssl">MQTT over SSL</a></td></tr><tr><td><strong>CA</strong></td><td>CA certificate, required when SSL is enabled and using self-signed certificates.</td></tr><tr><td><strong>Client Cert</strong></td><td>Client certificate, required when using SSL two-way authentication.</td></tr><tr><td><strong>Client Private Key</strong></td><td>Client key, required when using SSL two-way authentication.</td></tr></tbody></table><h3 id="offline-data-caching" tabindex="-1">Offline Data Caching <a class="header-anchor" href="#offline-data-caching" aria-label="Permalink to “Offline Data Caching”">​</a></h3><p>GridBeat&#39;s offline data caching is a valuable feature designed to enhance application robustness and reliability. This feature is particularly beneficial in environments where network connectivity is inconsistent, unstable, or limited. It works by locally storing data on the device running GridBeat during any network outages, enabling the MQTT plugin to synchronize data with the broker once the network connection is restored.</p><p>The process is straightforward: when a network disruption occurs, the MQTT plugin initially stores data in a memory cache. It only reverts to flushing data to a disk cache if the memory cache becomes full. Once the network connection is reestablished, the MQTT plugin starts publishing the cached data to the broker following a FIFO (First In, First Out) order. This streamlined approach ensures smooth data flow and connectivity, even in challenging network conditions.</p><p>Offline data caching is controlled by the <strong>Offline Data Caching</strong>, <strong>Cache Memory Size</strong>, and <strong>Cache Disk Size</strong> parameters. To enable the cache feature:</p><ol><li>Set the <strong>Offline Data Caching</strong> parameter to <em>true</em> and switch on offline data caching.</li><li>Set the <strong>Cache Memory Size</strong> parameter to specify the memory cache size in megabytes, and the max allowed memory cache size is 1GB.</li><li>Set the <strong>Cache Disk Size</strong> parameter to specify the disk cache size in megabytes, and the max allowed disk cache size is 10GB.</li><li>Set the <strong>Cache Sync Interval</strong> parameter to specify the cache message synchronizing interval in milliseconds, and the max allowed cache sync interval is 120s.</li></ol><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>The <strong>Offline Data Caching</strong> parameter is added since GridBeat version 2.4.3. For older versions, you may disable offline data caching by setting both <strong>Cache Memory Size</strong> and <strong>Cache Disk Size</strong> to zero.</p></div><p>The following table gives some statistics on disk space usage for offline caching (using the <a href="./../../south-devices/modbus-tcp/modbus-tcp.html">Modbus TCP plugin</a>).</p><ul><li>The first column is the number of tags in each MQTT message.</li><li>The second column is the MQTT message payload size in bytes for that many tags.</li><li>The third column is the number of cached messages on disk.</li><li>The fourth column is the resulting disk space usage in kilobytes.</li></ul><table tabindex="0"><thead><tr><th><em>Tags / Message</em></th><th><em>Message Payload (Bytes)</em></th><th><em>Cached Messages</em></th><th><em>Used Disk Size (KB)</em></th></tr></thead><tbody><tr><td>10</td><td>219</td><td>100</td><td>64</td></tr><tr><td>10</td><td>219</td><td>1000</td><td>349</td></tr><tr><td>100</td><td>1284</td><td>100</td><td>228</td></tr><tr><td>100</td><td>1284</td><td>1000</td><td>2077</td></tr><tr><td>1000</td><td>12993</td><td>100</td><td>1401</td></tr><tr><td>1000</td><td>12993</td><td>1000</td><td>13427</td></tr></tbody></table><h3 id="driver-status-report" tabindex="-1">Driver Status Report <a class="header-anchor" href="#driver-status-report" aria-label="Permalink to “Driver Status Report”">​</a></h3><p>The driver status reporting feature allows users to report the status of southbound drivers to a specified MQTT topic. To report driver status, set the <strong>Driver Status Report</strong> parameter to <code>True</code> and specify the <strong>Status Report Topic</strong> and <strong>Status Report Interval</strong> parameters. The reported data format is as follows:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1725583528917</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;states&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;modbus1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;running&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}, {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;s7-1200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;running&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}, {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;opcua1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;running&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Where:</p><ul><li><code>timestamp</code>：Report timestamp, in milliseconds.</li><li><code>states</code>：Driver status list, each element contains the following fields: <ul><li><code>node</code>：Southbound driver name.</li><li><code>link</code>：Driver connection status, 0 for disconnected, 1 for connected.</li><li><code>running</code>：Driver running status, 3 for running, 4 for stopped.</li></ul></li></ul><h3 id="mqtt-over-ssl" tabindex="-1">MQTT over SSL <a class="header-anchor" href="#mqtt-over-ssl" aria-label="Permalink to “MQTT over SSL”">​</a></h3><p>SSL/TLS (Secure Sockets Layer/Transport Layer Security) is a security protocol used to encrypt communication channels between networked devices. It enables secure communication over an insecure network, such as the Internet. MQTT over SSL/TLS is a secure method for transmitting MQTT messages between the client and the MQTT broker by encrypting the data being transmitted with SSL/TLS encryption. This ensures that all data passed between the clients and the broker are encrypted and secure.</p><p>The GridBeat MQTT plugin supports running MQTT over SSL. To enable SSL encryption, turn on the <strong>SSL</strong> parameter when configuring the node.</p><ul><li>If using self-signed certificates, the <strong>CA</strong> parameter should be provided with the server-side CA certificate. The certificate of the broker you are connecting to should be issued by the provided CA.</li><li>If using two-way authentication, you should also provide the client certificate and key file through the <strong>Client Cert</strong> and <strong>Client Private key</strong> parameters respectively.</li></ul><h2 id="add-subscription" tabindex="-1">Add Subscription <a class="header-anchor" href="#add-subscription" aria-label="Permalink to “Add Subscription”">​</a></h2><p>After plugin configuration, data forwarding can be enabled via southbound device subscriptions.</p><p>Click the device card or row on the <strong>North Apps</strong> page, then <strong>Add Subscription</strong> on the <strong>Group List</strong> page. And set the following:</p><ul><li><strong>South device</strong>: Select the southbound device you want to subscribe to, for example, &#39;modbus-tcp-1&#39;.</li><li><strong>Group</strong>: Select a group from the southbound device, for example, &#39;group-1&#39;.</li><li><strong>Topic</strong>: Specify the reporting topic, for example &#39;/gridbeat/mqtt/upload&#39;.</li></ul><p>Select the desired southbound device (e.g., &#39;modbus-tcp-1&#39;) and group (e.g., &#39;group-1&#39;). Lastly, specify the reporting topic, such as &#39;/gridbeat/mqtt/upload&#39;.</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Before GridBeat version 2.4.0, the GridBeat MQTT plugin will publish collected data in JSON to the topic designated by the <strong>upload-topic</strong> parameter.</p></div><figure align="center"><img src="`+s+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat version 2.4.0 MQTT subscribe interface"><figcaption align="center"><sub><b>Fig.2 - Setting upload topic in GridBeat version 2.4.0</b></sub></figcaption></figure><p>The exact format of the data reported is controlled by the <strong>Upload Format</strong> parameter. There are two formats, <em>tags-format</em> and <em>values-format</em>. For more detailed information, see <a href="./api.html#data-upload">Upstream/Downstream Data Format</a></p><h2 id="test-the-mqtt-plugin" tabindex="-1">Test the MQTT Plugin <a class="header-anchor" href="#test-the-mqtt-plugin" aria-label="Permalink to “Test the MQTT Plugin”">​</a></h2><p>This section will use the <a href="https://www.emqx.com/en/mqtt/public-mqtt5-broker" target="_blank" rel="noreferrer">public EMQX Broker</a> as an example to demonstrate how to use the MQTT plugin to forward the Modbus TCP data.</p><h3 id="southbound-plugin" tabindex="-1">Southbound Plugin <a class="header-anchor" href="#southbound-plugin" aria-label="Permalink to “Southbound Plugin”">​</a></h3><p>The southbound Modbus TCP plugin has been installed, the group and point configurations are complete, and communication with GridBeat is functioning normally. For details on the installation and configuration of the Modbus TCP plugin, refer to the <a href="./../../south-devices/modbus-tcp/modbus-tcp.html">Modbus TCP section</a>.</p><h3 id="northbound-plugin" tabindex="-1">Northbound Plugin <a class="header-anchor" href="#northbound-plugin" aria-label="Permalink to “Northbound Plugin”">​</a></h3><p>On <strong>Configuration -&gt; North Apps</strong>, click <strong>Add Application</strong> to add an MQTT client node.</p><p>Click the <strong>Application Configuration</strong> icon on the application card to enter the application configuration interface to set the MQTT connection, and set as follows:</p><ul><li><strong>Client ID</strong>: Note that each ID should be independent of each other and cannot be repeated. Here will use the default value of mqtt;</li><li><strong>Qos level</strong>: Quality of Service, options: 0, 1, 2. Here will use 0.</li><li><strong>Broker Host</strong>: Use the default public EMQX Broker (broker.emqx.io);</li><li><strong>Broker Port</strong>: Use MQTT broker port(1883);</li></ul><p>For the other fields, keep the default setting and click <strong>Submit</strong> to complete the configuration, and the application card will automatically enter the working state of <strong>Running</strong>.</p><p><img src="'+o+'" alt="Connect to MQTT"></p><ul><li>Client-id: Note that each ID should be independent of each other and cannot be repeated. Use the default value of mqtt;</li><li>Qos level: Quality of Service, divided into 0, 1, 2;</li><li>Host: Use the default public EMQX Broker (broker.emqx.io);</li><li>Port: Use MQTT broker port(1883);</li><li>Click <code>Submit</code> to complete the configuration of the northbound application, and the application card will automatically enter the working state of <strong>Running</strong>.</li></ul><h2 id="use-mqttx-to-view-data" tabindex="-1">Use MQTTX to View Data <a class="header-anchor" href="#use-mqttx-to-view-data" aria-label="Permalink to “Use MQTTX to View Data”">​</a></h2><p>After the subscription is completed, you can use the MQTT client (MQTTX is recommended and can be downloaded from <a href="https://www.EMQX.com/zh/products/MQTTX" target="_blank" rel="noreferrer">official website</a>) to connect to the public EMQX proxy to view the reported data.</p><p><strong>Establish Connection</strong></p><p>In MQTTX, click <strong>New Connection</strong> and configure as follows:</p><ul><li><strong>Name</strong>: Enter the connection name, for instance, &quot;gridbeatmqtt&quot;.</li><li><strong>Host</strong>: Keep the default broker.emqx.io.</li><li><strong>Port</strong>: Maintain the default value, which is 1883.</li><li>Leave other settings at their default values.</li></ul><p>Then click <strong>Connect</strong>.</p><p>Adding Subscription</p><p>In the connection window, click <strong>New Subscription</strong>. In the pop-up window, set up as follows:</p><ul><li><p>Topic: This should be consistent with the topic in Create and Configure a Northbound Plugin, for example, &quot;/gridbeat/mqtt/upload&quot;.</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Note: The default upload Topic format is &quot;/gridbeat/{node_name}/upload&quot;, where {node_name} is the name of the created northbound application. Users can also customize the upload topic.</p></div></li><li><p>QoS: Keep the default value, which is 0.</p></li><li><p>Leave other settings at their default values.</p></li></ul><p>At this point, we will be able to see the data forwarded by GridBeat in MQTTX, as shown in the figure below.</p><p><img src="'+r+'" alt="mqttx"></p><h2 id="operation-and-maintenance" tabindex="-1">Operation and Maintenance <a class="header-anchor" href="#operation-and-maintenance" aria-label="Permalink to “Operation and Maintenance”">​</a></h2><p>On the device card or device row, you can click on the <strong>Data Statistics</strong> icon to review the application&#39;s operation status and track the data received and sent. For explanations on statistical fields, refer to the <a href="./../north-apps.html">Create a Northbound Application</a> section.</p><p>If there are any issues with device operation, you can click on the DEBUG log chart. The system will automatically print DEBUG level logs for that node and switch back to the system default log level after ten minutes. Later, you can click on <strong>System Information</strong> -&gt; <strong>Logs</strong> at the top of the page to view logs and perform troubleshooting. For a detailed interpretation of system logs, see <a href="./../../../admin/log-management.html">Managing Logs</a>.</p>',62)])])}const k=e(l,[["render",d]]);export{f as __pageData,k as default};
