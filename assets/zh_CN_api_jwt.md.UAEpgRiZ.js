import{_ as i,c as a,o as t,ah as n}from"./chunks/framework.D2dsaVOY.js";const E=JSON.parse('{"title":"自定义 JWT","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/api/jwt.md","filePath":"zh_CN/api/jwt.md"}'),l={name:"zh_CN/api/jwt.md"};function e(h,s,p,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="自定义-jwt" tabindex="-1">自定义 JWT <a class="header-anchor" href="#自定义-jwt" aria-label="Permalink to “自定义 JWT”">​</a></h1><p>在 GridBeat 中调用 API 时，需先调用登录接口生成 JWT，再调用其他接口进行 JWT 验证。默认生成的 JWT 过期时间为一小时，可以自己生成 JWT，自定义过期时间。</p><h2 id="什么是-jwt" tabindex="-1">什么是 JWT？ <a class="header-anchor" href="#什么是-jwt" aria-label="Permalink to “什么是 JWT？”">​</a></h2><p>JWT 是一种用于安全传输信息的开放标准（RFC 7519）。JWT 结构包含三个部分，分别是头部（Header）、载荷（Payload）和签名（Signature）。</p><p>GridBeat 先根据 <strong>iss</strong> 字段查找 gridbeat 安装目录下的子目录 <strong>certs</strong> 是否包含该名称对应的 .pem 或 .pub 文件，再根据里面的字段进行校验。GridBeat 中所需要的 JWT 结构如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">header</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;alg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RS256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;typ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JWT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;iss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;iat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1679622798&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;exp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1679626398&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;aud&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gridbeat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;bodyEncode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="头部" tabindex="-1">头部 <a class="header-anchor" href="#头部" aria-label="Permalink to “头部”">​</a></h3><ul><li>令牌类型（typ）：使用 JWT</li><li>使用的算法（alg）：使用 RS256</li></ul><h3 id="载荷" tabindex="-1">载荷 <a class="header-anchor" href="#载荷" aria-label="Permalink to “载荷”">​</a></h3><ul><li>签发者（iss）：根据需求自己定义，但要确保与生成的公钥文件名称一致。例如，iss 为 gridbeat，则需要生成 gridbeat.pem 的公钥文件。</li><li>签发时间（iat）：签发时间</li><li>过期时间（exp）：签发过期时间</li><li>受众（aud）：gridbeat，不能修改</li></ul><h2 id="生成公私钥" tabindex="-1">生成公私钥 <a class="header-anchor" href="#生成公私钥" aria-label="Permalink to “生成公私钥”">​</a></h2><p>签发 JWT 前需要生成一对公私钥，并把生成的公钥 public.pem 放在 GridBeat 安装目录下的子目录 <strong>certs</strong> 中。GridBeat 自动加载 <strong>certs</strong> 中的文件，根据公钥解码。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Docker 以及 deb/rpm 安装包的默认安装路径为 <code>/opt/gridbeat</code>。</p><p>公钥文件名称必须要与 JWT 中的签发者保持一致。</p></div><p>使用 OpenSSL 命令行工具生成 RSA 密钥：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成私钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成公钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -pubout</span></span></code></pre></div><h2 id="如何生成-jwt" tabindex="-1">如何生成 JWT？ <a class="header-anchor" href="#如何生成-jwt" aria-label="Permalink to “如何生成 JWT？”">​</a></h2><p>使用 <a href="https://jwt.io/" target="_blank" rel="noreferrer">JWT 官网</a>工具生成。在 Decoded 中填写：</p><ul><li>Algorithm：RS256</li><li>Header：头部</li><li>Payload：载荷</li><li>Verify Signature：填写公私钥 <code>-----BEGIN PUBLIC KEY-----</code> 和 <code>-----BEGIN RSA PRIVATE KEY-----</code>。</li></ul>`,18)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
