import{_ as t,c as e,o as a,ah as r,jf as n,jg as s,jh as o,ji as d,jj as g,jk as l,jl as c,jm as f,jn as p,jo as h,jp as b,jq as u,jr as T,js as C,jt as m,ju as w,jv as A,jw as _,jx as D,jy as P,jz as x,jA as y}from"./chunks/framework.D2dsaVOY.js";const M=JSON.parse('{"title":"采集 PLC 数据","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/configuration/south-devices/ads/plc-ads/ads.md","filePath":"zh_CN/configuration/south-devices/ads/plc-ads/ads.md"}'),L={name:"zh_CN/configuration/south-devices/ads/plc-ads/ads.md"};function S(k,i,B,E,G,j){return a(),e("div",null,[...i[0]||(i[0]=[r('<h1 id="采集-plc-数据" tabindex="-1">采集 PLC 数据 <a class="header-anchor" href="#采集-plc-数据" aria-label="Permalink to “采集 PLC 数据”">​</a></h1><p>本教程介绍使用 GridBeat 通过 ADS 协议采集倍福 PLC 上不同地址区域的数据。</p><h2 id="环境介绍" tabindex="-1">环境介绍 <a class="header-anchor" href="#环境介绍" aria-label="Permalink to “环境介绍”">​</a></h2><p>本教程使用了在同一个局域网下的 2 台机器：</p><ul><li>机器 1 为 Linux 系统，安装了 GridBeat 软件；您可以查阅<a href="./../../../quick-start/installation.html">安装指南</a>以获取详细的 GridBeat 安装说明。</li><li>机器 2 为 Windows 系统，安装了倍福 TwinCAT 3 软件；您可以前往 <a href="https://www.beckhoff.com/en-us/products/automation/twincat" target="_blank" rel="noreferrer">Beckhoff TwinCAT 网站</a>下载和安装 TwinCAT 。</li></ul><table tabindex="0"><thead><tr><th></th><th>机器 1</th><th>机器 2</th></tr></thead><tbody><tr><td>操作系统</td><td>Linux</td><td>Windows</td></tr><tr><td>IP 地址</td><td>192.168.1.152</td><td>192.168.1.107</td></tr><tr><td>amsnetid</td><td>192.168.1.152.1.1</td><td>192.168.1.107.1.1</td></tr><tr><td>安装软件</td><td>GridBeat</td><td>TwinCAT</td></tr><tr><td>网络</td><td>连通</td><td>连通</td></tr></tbody></table><h2 id="配置-twincat" tabindex="-1">配置 TwinCAT <a class="header-anchor" href="#配置-twincat" aria-label="Permalink to “配置 TwinCAT”">​</a></h2><p>在 GridBeat 和倍福 PLC 之间建立通讯，添加路由、查找 AMS Net ID、AMS port、以及变量的 index group 和 index offset。</p><h3 id="在-twincat-中添加路由" tabindex="-1">在 TwinCAT 中添加路由 <a class="header-anchor" href="#在-twincat-中添加路由" aria-label="Permalink to “在 TwinCAT 中添加路由”">​</a></h3><p>打开 <strong>TwinCAT Static Routes</strong> 对话框。</p><figure align="center"><img src="'+n+'" style="border:thin solid #E0DCD9;width:60%;" alt="打开 TwinCAT static routes 对话框"><figcaption align="center"><sub><b>Fig.1 - 打开 TwinCAT static routes 对话框</b></sub></figcaption></figure><p>点击<strong>添加</strong>。</p><figure align="center"><img src="'+s+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT static routes 对话框"><figcaption align="center"><sub><b>Fig.2 - TwinCAT static routes 对话框</b></sub></figcaption></figure><p>输入下图红框内容，其中 <strong>AmsNetId</strong>，为 GridBeat 所在机器与倍福 PLC 相连的网卡的 IP 地址后加上 &quot;.1.1&quot; 。</p><figure align="center"><img src="'+o+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT add route 对话框"><figcaption align="center"><sub><b>Fig.3 - TwinCAT add route 对话框</b></sub></figcaption></figure><p>添加成功后，页面如下：</p><figure align="center"><img src="'+d+'" style="border:thin solid #E0DCD9;width:60%;" alt="更新后的 TwinCAT static routes 对话框"><figcaption align="center"><sub><b>Fig.4 - 更新后的 TwinCAT static routes 对话框</b></sub></figcaption></figure><h3 id="查看-ams-net-id-及-ams-port" tabindex="-1">查看 AMS Net ID 及 AMS Port <a class="header-anchor" href="#查看-ams-net-id-及-ams-port" aria-label="Permalink to “查看 AMS Net ID 及 AMS Port”">​</a></h3><p>打开 <strong>TwinCAT System</strong> 对话框查看 AMS Net ID。</p><figure align="center"><img src="'+g+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT system dialog"><figcaption align="center"><sub><b>Fig.5 - TwinCAT system 对话框</b></sub></figcaption></figure><p>TwinCAT PLC 默认端口号为 851。</p><figure align="center"><img src="'+l+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 项目页"><figcaption align="center"><sub><b>Fig.6 - TwinCAT PLC 项目页</b></sub></figcaption></figure><h3 id="查看变量-index-group-和-index-offset" tabindex="-1">查看变量 index group 和 index offset <a class="header-anchor" href="#查看变量-index-group-和-index-offset" aria-label="Permalink to “查看变量 index group 和 index offset”">​</a></h3><p>在本教程中我们使用以下 TwinCAT PLC 程序，其定义了足够的变量进行演示。</p><figure align="center"><img src="'+c+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 项目主程序"><figcaption align="center"><sub><b>Fig.7 - TwinCAT PLC 项目主程序</b></sub></figcaption></figure><h4 id="查看-index-group" tabindex="-1">查看 index group <a class="header-anchor" href="#查看-index-group" aria-label="Permalink to “查看 index group”">​</a></h4><p><a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tcadscommon/12495369867.html" target="_blank" rel="noreferrer">Beckhoff index group/offset 页面</a>列出了访问 PLC 内存范围所需的 index group。 对于 %MW 域，index group 为 0x4020 。对于 %MX 域，index group 为 0x4021。 对于主程序中定义的变量 <em>b、i8、u8、i16、u16、i32、u32、i64、u64、f32、f64、str</em>，index group 为 0x4040。</p><figure align="center"><img src="'+f+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT index group 表"><figcaption align="center"><sub><b>Fig.8 - TwinCAT index group 表</b></sub></figcaption></figure><h4 id="查看-index-offset" tabindex="-1">查看 index offset <a class="header-anchor" href="#查看-index-offset" aria-label="Permalink to “查看 index offset”">​</a></h4><p>在 TwinCAT 中打开 PLC 的数据区 (data area) 页面可以查看变量的 index offset。</p><figure align="center"><img src="'+p+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC data area tab"><figcaption align="center"><sub><b>Fig.9 - TwinCAT PLC 数据区页面</b></sub></figcaption></figure><h4 id="通过-tpy-文件查找-index-group-offset" tabindex="-1">通过 TPY 文件查找 index group/offset <a class="header-anchor" href="#通过-tpy-文件查找-index-group-offset" aria-label="Permalink to “通过 TPY 文件查找 index group/offset”">​</a></h4><p>您也可通过 TPY 文件找到 index group 和 index offset。</p><p>首先请确认 <strong>TPY 文件</strong> 已被启用。</p><figure align="center"><img src="'+h+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 项目配置页面"><figcaption align="center"><sub><b>Fig.10 - TwinCAT PLC 项目配置页面</b></sub></figcaption></figure><p>在项目路径打开 TPY 文件。</p><figure align="center"><img src="'+b+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 项目 TPY 文件路径"><figcaption align="center"><sub><b>Fig.11 - TwinCAT PLC 项目 TPY 文件路径</b></sub></figcaption></figure><p>TPY 文件中包含了 PLC 程序中所有变量的 index group 和 index offset 信息：</p><figure align="center"><img src="'+u+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 项目 TPY 文件内容"><figcaption align="center"><sub><b>Fig.12 - TwinCAT PLC 项目 TPY 文件内容</b></sub></figcaption></figure><h2 id="配置-gridbeat" tabindex="-1">配置 GridBeat <a class="header-anchor" href="#配置-gridbeat" aria-label="Permalink to “配置 GridBeat”">​</a></h2><h3 id="添加-ads-南向节点" tabindex="-1">添加 ADS 南向节点 <a class="header-anchor" href="#添加-ads-南向节点" aria-label="Permalink to “添加 ADS 南向节点”">​</a></h3><p>在 GridBeat 仪表板中，点击<strong>南向设备管理 -&gt; 添加设备</strong>来添加一个 ADS 节点。</p><figure align="center"><img src="'+T+'" style="border:thin solid #E0DCD9;width:60%;" alt="在 GridBeat 仪表板中添加 ADS 节点"><figcaption align="center"><sub><b>Fig.13 - 在 GridBeat 仪表板中添加 ADS 节点</b></sub></figcaption></figure><h3 id="配置-ads-节点" tabindex="-1">配置 ADS 节点 <a class="header-anchor" href="#配置-ads-节点" aria-label="Permalink to “配置 ADS 节点”">​</a></h3><p>请点击节点配置图标来配置新创建的 ADS 节点。</p><figure align="center"><img src="'+C+'" style="border:thin solid #E0DCD9;width:60%;" alt="在 GridBeat 仪表板中配置 ADS 节点"><figcaption align="center"><sub><b>Fig.14 - 在 GridBeat 仪表板中配置 ADS 节点</b></sub></figcaption></figure><h3 id="为-ads-节点添加点位" tabindex="-1">为 ADS 节点添加点位 <a class="header-anchor" href="#为-ads-节点添加点位" aria-label="Permalink to “为 ADS 节点添加点位”">​</a></h3><p>对于前文提及的 TwinCAT PLC 程序中的每个变量，我们将在 GridBeat ADS 节点上添加一个相应的点位。 <a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tc3_plc_intro/2529399691.html" target="_blank" rel="noreferrer">Beckhoff 数据类型</a>页面给出了数据类型的长度，结合程序源代码可以得出点位的数据类型。</p><figure align="center"><img src="'+m+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 主程序"><figcaption align="center"><sub><b>Fig.15 - TwinCAT PLC 主程序</b></sub></figcaption></figure><p>对于点位地址，index offset 可在 TwinCAT PLC 数据区页面查看。</p><figure align="center"><img src="'+w+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT PLC 数据区页面"><figcaption align="center"><sub><b>Fig.16 - TwinCAT PLC 数据区页面</b></sub></figcaption></figure><p>下图展示了我们往 ADS 节点添加的所有点位。</p><figure align="center"><img src="'+A+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat 仪表板中显示 ADS 节点点位"><figcaption align="center"><sub><b>Fig.17 - GridBeat 仪表板中显示 ADS 节点点位</b></sub></figcaption></figure><h2 id="数据监控" tabindex="-1">数据监控 <a class="header-anchor" href="#数据监控" aria-label="Permalink to “数据监控”">​</a></h2><h3 id="读点位" tabindex="-1">读点位 <a class="header-anchor" href="#读点位" aria-label="Permalink to “读点位”">​</a></h3><p>当 TwinCAT PLC 处于运行模式后，我们可以在界面中看到所有变量值。</p><figure align="center"><img src="'+_+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT 运行模式中的变量值"><figcaption align="center"><sub><b>Fig.18 - TwinCAT 运行模式中的变量值</b></sub></figcaption></figure><p>在 GridBeat 仪表板中，点击<strong>监控 -&gt; 数据监控</strong>查看变量值读取正确。</p><figure align="center"><img src="'+D+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat data monitoring tab"><figcaption align="center"><sub><b>Fig.19 - GridBeat 数据监控标签页</b></sub></figcaption></figure><h3 id="写点位" tabindex="-1">写点位 <a class="header-anchor" href="#写点位" aria-label="Permalink to “写点位”">​</a></h3><p>在 GridBeat <strong>数据监控</strong>标签页，在 <em>main.MXtest1</em> 点位上点击 <strong>Write</strong> 写入 true。</p><figure align="center"><img src="'+P+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat write main.MXtest1"><figcaption align="center"><sub><b>Fig.20 - GridBeat 写点位 main.MXtest1</b></sub></figcaption></figure><p>在 <em>main.MWtest1</em> 点位上点击 <strong>Write</strong> 写入值 <em>6666</em>。</p><figure align="center"><img src="'+x+'" style="border:thin solid #E0DCD9;width:60%;" alt="GridBeat write main.MWtest1"><figcaption align="center"><sub><b>Fig.21 - GridBeat 写点位 main.MWtest1</b></sub></figcaption></figure><p>写入成功后，可以在 TwinCAT 中查看变量值更新了。</p><figure align="center"><img src="'+y+'" style="border:thin solid #E0DCD9;width:60%;" alt="TwinCAT variable values updated"><figcaption align="center"><sub><b>Fig.22 - TwinCAT 中更新后的变量值</b></sub></figcaption></figure>',66)])])}const N=t(L,[["render",S]]);export{M as __pageData,N as default};
