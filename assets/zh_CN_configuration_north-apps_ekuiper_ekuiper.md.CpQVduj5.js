import{_ as s,c as a,o as e,ah as p,ig as n,ih as r,ii as t,ij as l,ik as h,il as k,im as d,io as o,ip as g,iq as E,ir as u,is as c}from"./chunks/framework.D2dsaVOY.js";const A=JSON.parse('{"title":"GridBeat 与 eKuiper 集成最佳实践","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/configuration/north-apps/ekuiper/ekuiper.md","filePath":"zh_CN/configuration/north-apps/ekuiper/ekuiper.md"}'),m={name:"zh_CN/configuration/north-apps/ekuiper/ekuiper.md"};function y(b,i,_,F,B,K){return e(),a("div",null,[...i[0]||(i[0]=[p(`<h1 id="gridbeat-与-ekuiper-集成最佳实践" tabindex="-1">GridBeat 与 eKuiper 集成最佳实践 <a class="header-anchor" href="#gridbeat-与-ekuiper-集成最佳实践" aria-label="Permalink to “GridBeat 与 eKuiper 集成最佳实践”">​</a></h1><p>本篇文章详细介绍通过 Docker Compose 的部署方式，实现 GridBeat2.4 和 eKuiper1.9 的 TCP 连接，并将 GridBeat 收集到的数据打印到 eKuiper 的日志中，以下为具体的配置过程。</p><h2 id="快速部署" tabindex="-1">快速部署 <a class="header-anchor" href="#快速部署" aria-label="Permalink to “快速部署”">​</a></h2><p>GridBeat 和 eKuiper 都支持二进制安装包以及 Docker 容器化部署方案。本文以 Docker 方案为例，采用 <a href="https://docs.docker.com/compose/" target="_blank" rel="noreferrer">docker compose</a> 方式，一键完成边缘端两个组件的快速部署。</p><ol><li><p>复制 <strong>docker-compose.yml</strong>文件到部署的机器上。其内容如下，包含了 GridBeat，eKuiper 以及 eKuiper 的管理界面 eKuiper manager。</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.4&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   manager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">emqx/ekuiper-manager:1.9</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ekuiper-manager</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9082:9082&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   ekuiper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lfedge/ekuiper:1.9</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9081:9081&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ekuiper</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ekuiper</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">         KUIPER__BASIC__CONSOLELOG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">         KUIPER__BASIC__IGNORECASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;false&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/tmp/data:/kuiper/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/tmp/log:/kuiper/log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   gridbeat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">emqx/gridbeat:2.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7000:7000&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # The default port to communicate with eKuiper. Change it if you want to use another port.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7081:7081&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gridbeat</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gridbeat</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">         DISABLE_AUTH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/tmp/gridbeat/data:/opt/gridbeat/persistence</span></span></code></pre></div><p>以下为配置说明：</p><ul><li><p>在本配置文件中，GridBeat 与 eKuiper 的通讯端口使用 7081，GridBeat 监听 7081 端口，等待 eKuiper 的链接。</p></li><li><p>由于 GridBeat 容器和 eKuiper 容器配置了 hostname，所以软件之间可以通过 hostname 相互访问，如果没有配置 hostname，可以通过宿主机的 IP 相互访问。</p></li><li><p>GridBeat、eKuiper 和 eKuiper-manager 的镜像版本，可根据实际使用情况自行调整，只要GridBeat &gt;= 2.4.0，eKuiper &gt;= 1.9.0即可，eKuiper-manager 版本与 eKuiper 版本最好保持一致。</p></li><li><p>eKuiper 环境变量配置，可参考 <a href="https://ekuiper.org/docs/zh/latest/configuration/configuration.html" target="_blank" rel="noreferrer">eKuiper - 配置</a></p></li></ul></li><li><p>在该文件所在目录，运行：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># docker compose up -d</span></span></code></pre></div></li><li><p>所有的容器启动完毕之后，请使用 <strong>docker ps</strong> 命令确定所有的容器已经正常启动。</p><p><img src="`+n+'" alt="image-20230416222743879"></p></li></ol><h2 id="配置-gridbeat" tabindex="-1">配置 GridBeat <a class="header-anchor" href="#配置-gridbeat" aria-label="Permalink to “配置 GridBeat”">​</a></h2><h3 id="添加南向设备" tabindex="-1">添加南向设备 <a class="header-anchor" href="#添加南向设备" aria-label="Permalink to “添加南向设备”">​</a></h3><p>GridBeat 启动之后，我们需要配置 GridBeat 的南向设备和北向 eKuiper 应用通道，然后启动模拟器进行模拟数据采集。</p><p>南向设备和模拟器配置，请参考 <a href="./../../../quick-start/quick-start.html">GridBeat 快速教程</a> ，完成南向配置部分。</p><h3 id="添加北向应用" tabindex="-1">添加北向应用 <a class="header-anchor" href="#添加北向应用" aria-label="Permalink to “添加北向应用”">​</a></h3><p>在配置菜单中选择<strong>北向应用管理</strong>，进入到北向应用管理界面，此时未添加任何应用，需要手动添加应用，在本例中，我们将创建一个 eKuiper 应用。</p><h4 id="添加应用" tabindex="-1">添加应用 <a class="header-anchor" href="#添加应用" aria-label="Permalink to “添加应用”">​</a></h4><ol><li>点击<strong>添加设备</strong>按键；</li><li>填写应用名称，例如，ekuiper-1；</li><li>在弹出的对话框中，输入名称，并选择 ekuiper 的插件，如下图所示。 <img src="'+r+'" alt="image-20230416223245020"></li><li>创建应用成功之后，会在北向应用管理界面出现一个刚刚创建的应用的卡片，此时应用的工作状态在初始化，连接状态在断开连接状态中。</li></ol><h4 id="应用配置" tabindex="-1">应用配置 <a class="header-anchor" href="#应用配置" aria-label="Permalink to “应用配置”">​</a></h4><p>点击查看第一步应用卡片 ekuiper-1 上的应用配置，点击确认，使用默认配置即可。</p><p><img src="'+t+'" alt="image-20230416223531514"></p><h4 id="订阅南向数据" tabindex="-1">订阅南向数据 <a class="header-anchor" href="#订阅南向数据" aria-label="Permalink to “订阅南向数据”">​</a></h4><p>点击第一步应用卡片 ekuiper-1 中任意空白处，进入到订阅Group界面，如下图所示。</p><p><img src="'+l+'" alt="image-20230416223756941"></p><ol><li>点击右上角的<strong>添加订阅</strong>按键添加订阅；</li><li>下拉框选择南向设备，这里我们选择之前建好的南向设备 Modbus1 ；</li><li>下拉框选择所要订阅的 Group，这里我们选择之前建好的南向设备 Modbus1 的group；</li><li>点击<strong>提交</strong>，完成订阅。</li></ol><p>至此，GridBeat 已配置好数据采集，并将采集到的数据发送到北向的 eKuiper 通道中。</p><p>注意：由于目前没有 eKuiper 连接到当前 GridBeat，所以 GridBeat 北向应用 eKuiper 节点的连接状态仍为<strong>断开状态</strong></p><p><img src="'+h+'" alt="image-20230416224028630"></p><h2 id="配置-ekuiper" tabindex="-1">配置 eKuiper <a class="header-anchor" href="#配置-ekuiper" aria-label="Permalink to “配置 eKuiper”">​</a></h2><p><a href="https://ekuiper.org/docs/zh/latest/operation/manager-ui/overview.html#%E6%A6%82%E8%A7%88" target="_blank" rel="noreferrer">eKuiper Manager</a> 是一个 Web 管理界面，可管理多个 eKuiper 实例。因此，我们需要设置 eKuiper Manager 管理的 eKuiper 实例。详细设置请参考eKuiper 管理控制台的使用。</p><p>以下教程中，我们使用 eKuiper Manager对 eKuiper 进行配置管理，包括流和规则的创建。</p><h3 id="添加-ekuiper-节点" tabindex="-1">添加 eKuiper 节点 <a class="header-anchor" href="#添加-ekuiper-节点" aria-label="Permalink to “添加 eKuiper 节点”">​</a></h3><p>通过 http://[yourhost]:9082 登录 ekuiper Manager，用户名密码为：admin/public</p><p>添加 eKuiper 服务：</p><p><img src="'+k+'" alt="image-20230416224606764"></p><ol><li><p>服务类型选择<strong>直接连接服务</strong></p></li><li><p>服务名称可自定义</p></li><li><p>端点URL，输入 eKuiper 容器的 hostname 加端口号 9081</p></li></ol><h3 id="创建-gridbeat-流" tabindex="-1">创建 GridBeat 流 <a class="header-anchor" href="#创建-gridbeat-流" aria-label="Permalink to “创建 GridBeat 流”">​</a></h3><p>登录 my-eKuiper 节点，在<strong>流管理</strong>页面创建流。具体配置如下：</p><p><img src="'+d+'" alt="image-20230416225210309"></p><ol><li><p>可自定义任意流名称，上图取名为 gridbeatStream</p></li><li><p>流类型设置为 <strong>gridbeat</strong>，表示该流会连接到 GridBeat 中。</p></li><li><p>配置组，选择添加配置组，名称为 gridbeat-source，路径为 tcp://gridbeat:7081。其中 GridBeat 与 GridBeat 容器的 hostname 一致。</p></li><li><p>点击<strong>提交</strong>。</p></li></ol><h3 id="配置-ekuiper-规则" tabindex="-1">配置 eKuiper 规则 <a class="header-anchor" href="#配置-ekuiper-规则" aria-label="Permalink to “配置 eKuiper 规则”">​</a></h3><p>GridBeat 流建立之后，我们可以在 eKuiper 里创建任意多条规则，对采集的数据进行各种计算和处理。本文仅介绍GridBeat 与 eKuiper 的 TCP 通讯建立和数据打通，所以仅配置一个最简单的规则，将 GridBeat 的数据打印到eKuiper 的 log 中。</p><p>新建 eKuiper 规则如下：</p><p><img src="'+o+'" alt="image-20230416225851891">添加规则动作，并提交规则。</p><p><img src="'+g+'" alt="image-20230416225937554"></p><h2 id="查看-gridbeat-与-ekuiper-连通状态" tabindex="-1">查看 GridBeat 与 eKuiper 连通状态 <a class="header-anchor" href="#查看-gridbeat-与-ekuiper-连通状态" aria-label="Permalink to “查看 GridBeat 与 eKuiper 连通状态”">​</a></h2><p>GridBeat 连接状态正常</p><p><img src="'+E+'" alt="image-20230416230130253"></p><p>eKuiper 规则运行状态正常</p><p><img src="'+u+'" alt="image-20230416230150498"></p><p>eKuiper 日志信息正常</p><p><img src="'+c+'" alt="image-20230416230234064"></p>',47)])])}const C=s(m,[["render",y]]);export{A as __pageData,C as default};
